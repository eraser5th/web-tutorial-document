# DOM

---

## 今回の目的

前回のHTML・CSS勉強会により、簡易的なWebページの作成は可能になった。しかしあれだけではWebアプリケーションとしての*"機能"*が作成できない。よって今回はDOMと呼ばれるものを学ぶことにより、基礎的なWebアプリケーションの作成ができる様になっていただきます。

---

## まずはJavaScriptの復習から

第一回の資料をざっとおさらいしよう！

- [ドキュメント形式](https://hackmd.io/wOmDxIn2SeigrJmLcO2NyA)
- [スライド形式](https://hackmd.io/@ERASER/HyQhPHKH9)

---

## DOM（Document Object Model）とは？

DOMは、ウェブページとプログラミング言語（今回であればJavaScript）を接続するものです。これによりJavaScriptなどからHTML要素などを操作することができます。

---

## 試してみよう

1. ブラウザで https://codepen.io/eraser5th/pen/zYRMVJm にアクセス

1. 開発者ツールでコンソールを開く

1. 左下の JavaScript を記述するところで以下のようなものを試してみる

1. 以下を記述

```javascript=
const pElements = document.getElementsByTagName("p")
console.log(pElements)
```

すると、`console.log` をした結果が開発者ツールのコンソール上に表示される



ブラウザで https://sccp2021.github.io/html_learn/ にアクセス

開発者ツールでコンソールを開く

以下を実行

```javascript=
document.getElementById("main")
document.getElementById("greeting")
document.getElementsByClassName("content")
document.getElementsByTagName("div")
let greeting = document.getElementById("greeting")
greeting.textContent = "I'm mayamito."
```
-->

---

## 今回使用するDOMインターフェースの紹介

DOMはDOMインターフェースと呼ばれるものを通して操作することができます。  
つまり、これから我々は「DOMインターフェースを使ってDOMを操作することによりHTML要素を操作する」方法を学びます。  
そのためにまずはどの様なDOMインターフェースが存在するのかを紹介します。

---

### `Document`

読み込まれたWebページ全体の情報を扱うオブジェクト。  
このオブジェクトを操作することによりWebページを操作したり、HTML要素などを生成したりすることができます。  
JavaScript には`document`というグローバルオブジェクトが元々作られています。(クライアントサイド JavaScript が起動するタイミングで自動的に生成されます)

[詳細](https://developer.mozilla.org/ja/docs/Web/API/Document)

---

### `Element`

`Document`内部（すなわちWebページの中）にある要素は全て`Element`というオブジェクト（もしくはその派生）です。  
例えばHTML要素は全て`Element`の派生である`HTMLElement`（の派生）です。

---

### `Event`

`Event`はDOMで発生するイベントを表すオブジェクトです。  
イベントの例としてはクリック、キーボードの入力などが挙げられる。

---

## `Document`の詳細

Documentの主な機能と使い方を説明します。

---

### `Document.createElement()`

指定したタグのHTML要素を作ります。

```javascript=
const pElement = document.createElement('p')

console.log(pElement) // 期待する出力: <p></p>

pElement.textContent = 'hello!'

console.log(pElement) // 期待する出力: <p>hello!</p>
```

ちなみに、これはただ要素を作成して変数に入れただけなので、実際に表示させるには、後々紹介する `Element.append()` などと合わせて使う必要があります。

---

### `Document.getElementsByTagName()`

開いているWebページから、指定したタグのHTML要素を全て取得します。

:::warning
取得したデータは配列の様な構造ですが、正確には配列ではないので注意が必要。
:::

[https://codepen.io/eraser5th/pen/zYRMVJm](https://codepen.io/eraser5th/pen/zYRMVJm) を開いて、JavaScriptのところに記述してみてください。

```javascript=
const pElements = document.getElementsByTagName('p')

console.log(pElements[0])

console.log(pElements[0].textContent) // 期待する出力: I'm Kato Takeshi.

pElements[0].textContent = "wryyyyyyyyyyyyyyyyyyy"
```

---

### `Document.getElementsByClassName()`

開いているWebページから、指定したクラスのHTML要素を全て取得します。

:::warning
取得したデータは配列の様な構造ですが、正確には配列ではないので注意が必要。
:::

```javascript=
const contentClassElements = document.getElementsByClassName('content')

console.log(contentClassElements[0])

console.log(contentClassElements[0]) // 期待する出力はちょっと長いので省略
```

### `Document.getElementById()`

開いているWebページから、指定したIDのHTML要素を一つ取得します。  
（同じIDを持つ要素は存在しないため）

```javascript=
const mainIdElement = document.getElementById('main')

console.log(mainIdElement) // 期待する出力はちょっと長いので省略
```

---

### `Document.querySelector()`

開いているWebページから、セレクターに一致した要素を一つ取得します。  
セレクターは第二回のCSS部分で説明したものを用います。

```javascript=
const spanElement = document.querySelector("p span")

console.log(spanElement.textContent) // 期待する出力: watching Vtuber.
```

:::spoiler おまけ情報
第二回勉強会でちらっと紹介した、 CSSDinner というサイトで遊ぶと、CSSセレクターに慣れられるよ！

[CSSDinner](https://flukeout.github.io/)
:::

---

### `Document.querySelectorAll()`

開いているWebページから、セレクターに一致した要素を全て取得します。  
セレクターは第二回のCSS部分で説明したものを用います。

```javascript=
const pWithContentClassElements = document.querySelectorAll("p.content")

console.log(pWithContentClassElement[0]) // 期待する出力はちょっと長いので省略

```

---

## `Element`の詳細

Elementの主な機能と使い方を説明します。

---

### `Element.className`

その要素の`class`が入っている。書き換え可能。

```javascript=
const divElement = document.createElement('div')

console.log(divElement)

divElement.className = 'bg_red'

console.log(divElement)
```

---

### `Element.id`

その要素の`id`が入っている。書き換え可能。

```javascript=
const divElement = document.createElement('div')

console.log(divElement)

divElement.id = 'homeButton'

console.log(divElement)
```

---

### `Element.children`

その要素の子要素が入っている。書き換えできない。

:::warning
配列の様な構造ですが、正確には配列ではないので注意が必要。
:::

```javascript=
const parent = document.createElement('div')
parent.append(document.createElement('h1'))
parent.append(document.createElement('p'))

console.log(parent)
console.log(parent.children[0])
```

---

### `Element.textContent`

その要素の持つテキスト（文字列）が入っている。書き換え可能。

```javascript=
const h1Element = document.createElement('h1')

console.log(h1Element)

h1Element.textContent = 'hello!'

console.log(h1Element)
```

---


### `Element.append()`

自身の子要素のリスト（`children`）に対し引数に渡した`Element`または文字列を末尾追加する。  
複数一度に`append`することもできる。

```javascript=
const divElement2 = document.createElement('div')

divElement2.append(
  document.createElement('h1')
)

console.log(divElement2)

// 複数こでもOK
divElement2.append(
  document.createElement('p'),
  document.createElement('p'),
)

console.log(divElement2)
```

---

### `Element.remove()`

親要素の子リスト(children)から自身を取り除きます。

```javascript=
const divElement3 = document.createElement('div')
const h1Element = document.createElement('h1')
divElement3.append(h1Element)

console.log(divElement3)

h1Element.remove()

console.log(divElement3)
```

---

### `EventTarget.addEventListener()`

`EventTarget`となっている通り正確には`Element`の機能ではない。ただし`Element`は`EventTarget`の一種なので使うことができる。なのでここで紹介しておく。

イベントの種類と実行させたい関数を渡すことで、その種類のイベントが発生した際にその関数を実行することができる。

```javascript=
const button = document.getElementById('button')

button.addEventListener('click', function() {
  alert('hello! I get click event!')
})
```

---

### `value`

inputやtextareaなどの一部の`Element`に存在するプロパティ。  
入力した文字列などが入っている。

```javascript=
let textarea = document.getElementById("input")
console.log(textarea.value)
textarea.value = "aaaaaaaaaaaaaa"
```

---

## `Event`の詳細

---

### `Event.target` 

クリックされた対象など、イベントが起こった要素をあらわす。

---

## 演習

### 問題１

[リンク](https://codepen.io/eraser5th/pen/xxYQeRK)を開いて、ここまでの内容を試してみてください。

### 問題２　カウンター

カウンターを作ってみよう。機能としては以下のものができていると嬉しい。

- カウントの表示
- カウントを増やす
- カウントを減らす
- カウントをリセットする

[回答例](https://codepen.io/eraser5th/pen/QWQJPdx)

---

### 問題３　インプット

ユーザーから文字列を受け取り、ボタンを押したら受け取った文字列を`alert`関数を使って表示する様にしてみよう。

[回答例](https://codepen.io/matumoto1234/pen/MWQZgbw)

---

### 問題４　flex-box

flex-boxと呼ばれるCSSの大事な要素について勉強しよう。おそらくこの後の課題において大いに役立つはずです。
これはさまざまなところで使います。なんならこれができれば見た目を作るのに困ることはないと言っても過言ではないでしょう（過言です）

これはflex-boxをちょっとしたゲームの様なもので勉強できるサイト。とりあえず行けるところまでやってみてください。

[https://flexboxfroggy.com/#ja](https://flexboxfroggy.com/#ja)

これが終わってもっと知りたい方は、

[https://web.dev/learn/css/flexbox/](https://web.dev/learn/css/flexbox/)

---

## 課題

ここからは問題を順にやっていき、TODOリストを作ってみよう。画像をいくつか載せていますが、同じ見た目を作る必要はありません

機能としては以下を実装してもらいます。

- タスクの追加
- タスクの削除

---

### ステップ1 TODO一個を作ろう

#### 問題1-1 まずはHTMLで

まずはHTML・CSSのみで、TODOひとつひとつの見た目を作りしょう。

::: warning
`button`タグを使う際は`type="button"`を指定するように気をつけてください。
```javascript=
<button type="button">ボタン</button>
```
:::

イメージ :arrow_down: （見た目にこだわらず、最低限の機能さえあれば問題ないです！）

![](https://i.imgur.com/nYjQbBX.png)

[回答例](https://codepen.io/eraser5th/pen/qBxQMEB)

<!-- この補足いる？いらなくない？コメントとして残すくらいであればまあ -->
<!--
:::spoiler 補足
- また、`<input type="button"></input>` と `<button></button>` では基本的に `button`タグを使用するほうが良いとされています
    - ``<button><img src="なんかのURL"> </button>`` のように、ボタンのラベルに画像を持たせたりできるからです
    - [参考](https://stackoverflow.com/questions/469059/button-vs-input-type-button-which-to-use)
:::
-->

#### 問題1-2 次にJSで

次にJavaScriptで先ほどHTMLで書いたTODO用の要素を生成する関数を作ろう。

:::info
JavaScript から生成するので、HTMLは書かなくて大丈夫です！
:::

[回答例](https://codepen.io/eraser5th/pen/mdXQGLB)

#### 問題1-3 次に削除ボタンを動くようにしよう

削除ボタンが先ほどまでは動かなかったので、先ほど作った関数を修正して動くようにしてみましょう。

:::info
- `Element.remove()` を使うことで、要素を削除することができます！
- 今回削除したい要素は `todoItem` です！
- `Element.addEventListener('click', ここに関数)` の形式で関数を渡すことで、渡した関数をクリック時に実行できます！
:::

[回答例](https://codepen.io/eraser5th/pen/QWQJZWP)

---

### ステップ２ TODOの追加先（一覧）を作ろう

TODOの追加先（一覧）を作成します。

イメージ :arrow_down:

![](https://i.imgur.com/IBVOIAg.png)

[回答例](https://codepen.io/eraser5th/pen/ZErmqJO)

---

### ステップ３ TODOの入力・追加部分を作ろう

#### まずはHTML・CSS

まずはHTML・CSSで見た目だけ作ってみよう。

イメージ :arrow_down:

![](https://i.imgur.com/soTXhad.png)

[回答例](https://codepen.io/eraser5th/pen/rNJQqvy)

---

#### 追加機能を作ろう

JavaScriptを使って、問題２で作ったTODOの一覧に追加できる様にしよう。これにてTODOリストは出来上がりです！

[回答例](https://codepen.io/eraser5th/pen/vYdQVPv)

[かなり難しい実装例](https://codepen.io/eraser5th/pen/yLvQGRW)（わからなくてもOKだけど、これができると応用がしやすい）
